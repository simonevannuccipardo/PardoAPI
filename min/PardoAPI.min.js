class PardoAPI{url="https://content.locarnofestival.ch/api";content="/content";item="/item";items="/items";assets="/assets";image=this.assets+"/image";headerApi="api-key";api="";saveLocaldata=0;map;lang;constructor(t,e="en"){this.api=t,this.lang=e}async request(t,e="GET"){var a=new Headers;a.append(this.headerApi,this.api);let o=await fetch(t,{method:e,headers:a,redirect:"follow"}),r=await o.json();return r}get getLocale(){return"?locale="+this.lang}get urlAssets(){return this.url+this.assets}get urlImage(){return this.urlAssets+this.image}get urlCollectionContents(){return this.url+this.content+this.items}get urlContent(){return this.url+this.content+this.item}getFilter(t,e){return"{"+t+':"'+e+'"}'}}class PardoGET extends PardoAPI{constructor(t,e="en"){super(t,e)}getItems(t){var e=super.urlCollectionContents+"/"+t+super.getLocale;return super.request(e)}getItem(t,e){var a=super.urlContent+"/"+t+"/"+e+super.getLocale;return super.request(a)}getItemByAttr(t,e,a="name"){var o=super.urlCollectionContents+"/NaN"+getFilter(a,e);return super.request(o)}}class PardoMAP extends PardoGET{mapBoxApi="";attrMap='\xa9 <a href="https://www.mapbox.com/map-feedback/">Mapbox</a>\xa9 <a href="https://www.openstreetmap.org/copyright"> OpenStreetMap contributors</a>';urlMapbox="https://{a-d}.tiles.mapbox.com/v4/mapbox.mapbox-streets-v6/{z}/{x}/{y}.vector.pbf?access_token=";centerLat="46.1623";centerLon="8.7786";zoom="14";duration=1e3;defaultIcon="https://assets.locarnofestival.ch/data/web-tools/ico-locate.png";typeData="poi";constructor(t,e,a="en"){super(t,a),this.mapBoxApi=e}setCenterLat(t){this.centerLat=t}setCenterLon(t){this.centerLon=t}setZoom(t){this.zoom=t}setDuration(t){this.duration=t}setDefaultIcon(t){this.defaultIcon=t}setTypeData(t){this.typeData=t}setTarget(t){this.target=t}getMap(t){var e=new ol.Map({interactions:ol.interaction.defaults({mouseWheelZoom:!1}).extend([new ol.interaction.MouseWheelZoom({condition:ol.events.condition.platformModifierKeyOnly}),]),layers:[new ol.layer.VectorTile({declutter:!0,source:new ol.source.VectorTile({attributions:this.attrMap,format:new ol.format.MVT,url:this.urlMapbox+this.mapBoxApi}),style:createMapboxStreetsV6Style(ol.style.Style,ol.style.Fill,ol.style.Stroke,ol.style.Icon,ol.style.Text)})],target:t,view:new ol.View({center:ol.proj.fromLonLat([this.centerLon,this.centerLat]),zoom:this.zoom})});e.addControl(new ol.control.Zoom({duration:this.duration})),e.addInteraction(new ol.interaction.DoubleClickZoom({duration:this.duration})),e.addInteraction(new ol.interaction.KeyboardZoom({duration:this.duration})),this.map=e}addSinglePoi(t,e=this.defaultIcon){super.getItem(this.typeData,t).then(t=>{var a=this.addMarker(t,e);this.map.addLayer(a)})}addPois(t=this.typeData,e=this.defaultIcon){super.getItems(this.typeData).then(t=>{t.forEach(t=>{var a=this.addMarker(t,e);this.map.addLayer(a)}),this.addPopups()})}addMarker(t,e=this.defaultIcon){return new ol.layer.Vector({source:new ol.source.Vector({features:[new ol.Feature({geometry:new ol.geom.Point(ol.proj.fromLonLat([t.coord.lon,t.coord.lat])),category:t.category,name:t.name,street:t.street,cap:t.cap,city:t.city,lon:t.coord.lon,lat:t.coord.lat,npark:t.npark,description:t.description,tech_details:t.tech_details,acc_details:t.acc_details,seat:t.seat,page_url:t.page_url,pic_url:t.pic_url[0],custom_text:t.custom_text})]}),style:new ol.style.Style({image:new ol.style.Icon({anchor:[.5,1],src:e})})})}addPopups(){this.map.on("click",function(t){let e=this.forEachFeatureAtPixel(t.pixel,function(t){return t});if(e&&e.get("category")){let a=new CustomEvent("openPopup",{detail:e});document.dispatchEvent(a)}else{let o=new CustomEvent("closePopup");document.dispatchEvent(o)}}),this.map.on("movestart",function(){let t=new CustomEvent("closePopup");document.dispatchEvent(t)})}}
